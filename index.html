<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toyota Bobby Almacen - Car View</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for a modern, dashboard feel */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FFFFFF;
            /* Remove overflow: hidden to allow scrolling on smaller screens if necessary */
            transition: background-color 0.3s;
        }

        /* --- DARK MODE BASE STYLES --- */
        body.dark-mode {
            background-color: #0d0d0d;
        }
        body.dark-mode #left-panel {
            background-color: #0d0d0d; /* Dark background for the main panel */
            color: #f0f0f0;
        }
        body.dark-mode #clock-display {
            color: #b0b0b0;
        }
        body.dark-mode .text-gray-800 {
            color: #f0f0f0; /* Overrides default text color */
        }
        body.dark-mode #weather-display {
            color: #f0f0f0;
        }
        /* Mode Controls in Dark Mode */
        body.dark-mode .mode-button {
            color: #444 !important; /* Inactive text */
        }
        body.dark-mode .mode-button.text-red-500 {
            color: #ff8a80 !important; /* Active text */
        }
        /* Inputs/Buttons are removed, so no dark mode for them is needed. */
        body.dark-mode #theme-toggle-button {
            background-color: #333333;
            color: #ffffff;
        }

        /* --- SPLASH SCREEN STYLES --- */
        #splash-screen {
            position: fixed;
            inset: 0;
            background-color: #FFFFFF;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease-out;
            opacity: 1;
        }
        body.dark-mode #splash-screen {
            background-color: #1a1a1a;
        }
        
        /* Hide main dashboard until loaded */
        #main-container {
            opacity: 0;
            transition: opacity 0.5s;
        }

        /* --- DASHBOARD STYLES --- */
        .mode-button {
            transition: color 0.3s, transform 0.1s;
            cursor: pointer;
            font-weight: 600;
            user-select: none;
            flex-grow: 1;
            text-align: center;
            padding: 8px 0; /* Add padding for better touch targets */
            border-radius: 8px; /* Slight round for modern look */
        }
        .mode-button:active {
            transform: scale(0.98);
        }
        
        #message-box {
            z-index: 1001; /* Higher z-index to be on top of the full screen */
            transition: opacity 0.3s, transform 0.3s;
            opacity: 0;
            pointer-events: none;
            transform: scale(0.95);
        }
        #message-box.active {
            opacity: 1;
            pointer-events: auto;
            transform: scale(1);
        }
        #car-video {
            width: 100%;
            height: 100%;
            object-fit: contain; /* Changed to 'contain' for full visibility */
            opacity: 1;
            transition: opacity 0.5s;
        }

        /* --- CORE 3D STYLES --- */
        #car-display-container {
            /* Now takes up more space */
            perspective: 1200px;
            background-color: #FFFFFF;
            transition: background-color 0.3s;
            padding: 1rem; /* Added padding */
            /* REMOVED: max-height: 70vh; to allow the car image to grow */
        }
        body.dark-mode #car-display-container {
            background-color: #0d0d0d;
        }
        /* Adjusted positioning for full-width display */
        #temp-car-img {
            transform-style: preserve-3d;
            backface-visibility: hidden;
            border: none !important;
            outline: none !important;
            box-shadow: none !important;
        }
        .fade-out {
            opacity: 0;
            transform: translateZ(-200px) rotateY(15deg);
            transition: opacity 0.5s ease-in, transform 0.5s ease-in;
        }
        .fade-in-scale {
            opacity: 1;
            transform: translateZ(0) rotateY(0deg);
            transition: opacity 1.0s ease-out, transform 1.0s ease-out;
        }
    </style>
</head>
<body class="h-screen">
    
    <div id="splash-screen">
        <div id="splash-video-container" class="w-full h-full max-w-xl max-h-xl overflow-hidden flex justify-center items-center">
            <img id="splash-image" src="toyotalogo.png" alt="Toyota Logo" class="w-32 h-32 object-contain" style="opacity: 0; transition: opacity 0.5s;">
        </div>
    </div>
    
    <div id="message-box" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-[1001]">
        <div class="bg-gray-900 p-6 rounded-xl shadow-2xl max-w-lg w-full text-white border border-red-500">
            <h3 id="msg-title" class="text-xl font-bold mb-3 text-red-400">Title</h3>
            <p id="msg-content" class="mb-4 text-gray-200 text-sm leading-relaxed"></p>
            <div id="msg-sources" class="text-xs text-gray-500 mt-2 space-y-1"></div>
            <button id="msg-close-button" class="mt-4 w-full py-2 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition">
                Close
            </button>
        </div>
    </div>

    <div id="main-container" class="flex flex-col h-full w-full">

        <div id="left-panel" 
             class="p-4 bg-white flex flex-col justify-between items-center text-gray-800 relative h-full w-full transition-colors duration-300">

            <div class="flex flex-col items-center pt-4 pb-2 w-full">
                <div class="mb-1">
                    <img 
                        src="toyotalogo.png" 
                        alt="Car Brand Logo" 
                        class="w-40 h-20 object-contain"
                        onerror="this.onerror=null;this.src='https://placehold.co/128x64/CCCCCC/333333?text=Logo';"
                    >
                </div>
                <div class="text-3xl font-light tracking-widest text-gray-800 mt-1">VIOS</div>
            </div>

            <div id="car-display-container" class="relative w-full max-w-5xl flex flex-grow justify-center items-center overflow-hidden">
                <video id="car-video" src="" autoplay muted playsinline loop
                        class="w-auto h-full object-contain transition-opacity duration-300">
                    Your browser does support the video tag.
                </video>
                <div id="video-fallback-message" class="absolute inset-0 bg-white/80 flex flex-col justify-center items-center text-center p-4 hidden">
                    <p class="text-red-500 font-bold text-xl mb-2">VIDEO FILE MISSING</p>
                    <p class="text-gray-600 text-sm">Source: <span id="missing-video-filename" class="font-mono text-yellow-600"></span></p>
                    <p class="text-gray-700 text-xs mt-2">Make sure that file is in the same folder as this HTML file and the name is spelled exactly the same!</p>
                </div>
                
            </div>
            
            <div class="absolute top-4 right-4 flex flex-col items-end space-y-2">
                
                <div id="clock-display" class="text-right text-gray-700">
                    </div>

                <div id="weather-display" class="text-right text-gray-700">
                    </div>
            </div>

            <div class="absolute top-4 left-4 flex flex-col items-start space-y-2 z-10">
                <button 
                    id="theme-toggle-button" 
                    class="px-3 py-1 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-full shadow-lg transition duration-150 transform hover:scale-105 active:scale-95 text-sm font-semibold flex items-center space-x-1"
                >
                    <span id="theme-icon">üåô</span>
                    <span id="theme-text">Night Mode</span>
                </button>
            </div>


            <div class="flex items-center justify-center w-full max-w-xl pt-6 pb-4 border-t border-gray-300">
                
                <div id="mode-controls" class="flex w-full space-x-4 text-2xl text-gray-500 justify-center">
                    <span id="MANUAL" class="mode-button">MANUAL</span>
                    <span id="DRIVE" class="mode-button text-red-500">DRIVE</span> 
                    <span id="REVERSE" class="mode-button">REVERSE</span>
                    <span id="PARK" class="mode-button">PARK</span>
                </div>

            </div>

        </div>
        </div>

    <script>
        // --- GLOBAL ELEMENT REFERENCES ---
        const carVideo = document.getElementById('car-video'); 
        const splashScreen = document.getElementById('splash-screen');
        const splashImage = document.getElementById('splash-image');
        const carDisplayContainer = document.getElementById('car-display-container');
        const modeButtons = document.querySelectorAll('.mode-button');
        const modeControls = document.getElementById('mode-controls');
        
        // Removed elements: startInput, destinationInput, goButton, mapIframe, navHeader, etc.
        const weatherDisplay = document.getElementById('weather-display');
        const clockDisplay = document.getElementById('clock-display');
        const mainContainer = document.getElementById('main-container');
        const body = document.body;

        const videoFallbackMessage = document.getElementById('video-fallback-message');
        const missingVideoFilename = document.getElementById('missing-video-filename');

        const msgBox = document.getElementById('message-box');
        const msgTitle = document.getElementById('msg-title');
        const msgContent = document.getElementById('msg-content');
        const msgSources = document.getElementById('msg-sources');
        const msgCloseButton = document.getElementById('msg-close-button');

        const themeToggleButton = document.getElementById('theme-toggle-button');
        const themeIcon = document.getElementById('theme-icon');
        const themeText = document.getElementById('theme-text');

        // --- LOCATION STATE & CONFIG (SIMPLIFIED) ---
        let currentMode = 'DRIVE'; 
        
        const carVideos = {
            'MANUAL': "manual.png",
            'DRIVE': "drive.png", 
            'REVERSE': "reverse.png",
            'PARK': "park.png"
        };
        
        // --- WEATHER STATE & LOGIC ---
        let weatherDataIndex = 0;
        const localWeather = [
            { icon: '‚òÄÔ∏è', temp: '31¬∞C', condition: 'Sunny' },
            { icon: 'üåßÔ∏è', temp: '25¬∞C', condition: 'Rainy' },
            { icon: '‚òÅÔ∏è', temp: '28¬∞C', condition: 'Partly Cloudy' },
            { icon: '‚ö°', temp: '26¬∞C', condition: 'Storms' }
        ];

        function updateWeatherDisplay() {
            const weather = localWeather[weatherDataIndex];
            const isDarkMode = document.body.classList.contains('dark-mode');
            const textColorClass = isDarkMode ? 'text-gray-300' : 'text-gray-900';
            const tempColorClass = isDarkMode ? 'text-gray-200' : 'text-gray-800';

            // Updated for larger size
            weatherDisplay.innerHTML = `
                <div class="flex items-center text-sm font-semibold">
                    <span class="text-xl font-bold ${tempColorClass}">${weather.temp}</span>
                    <span class="text-2xl ml-2 ${tempColorClass}">${weather.icon}</span>
                    <span class="text-base font-normal ml-2 hidden sm:inline-block ${textColorClass}">${weather.condition}</span>
                </div>
            `;
        }

        function cycleWeather() {
            weatherDataIndex = (weatherDataIndex + 1) % localWeather.length; 
            updateWeatherDisplay();
        }
        
        // --- UI UTILITY FUNCTIONS ---
        function showMessageBox(title, message, sources = []) {
            msgTitle.textContent = title;
            msgContent.innerHTML = message;
            msgSources.innerHTML = ''; 
            if (sources && sources.length > 0) {
                const sourceTitle = document.createElement('p');
                sourceTitle.classList.add('font-bold', 'text-gray-400', 'mt-4');
                sourceTitle.textContent = 'Sources:';
                msgSources.appendChild(sourceTitle);
                sources.forEach((source, index) => {
                    const link = document.createElement('a');
                    link.href = source.uri;
                    link.target = '_blank';
                    link.classList.add('block', 'underline', 'hover:text-red-300');
                    link.textContent = `${index + 1}. ${source.title}`;
                    msgSources.appendChild(link);
                });
            }
            msgBox.classList.add('active');
        }
        function hideMessageBox() { msgBox.classList.remove('active'); }

        function updateClock() {
            const now = new Date();
            const optionsDate = { weekday: 'short', month: 'short', day: 'numeric' };
            const optionsTime = { hour: '2-digit', minute: '2-digit', hour12: true };

            // Using Asia/Manila for Philippine Standard Time (PST)
            const dateStr = now.toLocaleDateString('en-US', { ...optionsDate, timeZone: 'Asia/Manila' });
            const timeStr = now.toLocaleTimeString('en-US', { ...optionsTime, timeZone: 'Asia/Manila' });

            // Updated for larger size and order (Time then Date)
            clockDisplay.innerHTML = `
                <div class="text-xl font-bold">${timeStr} PST</div>
                <div class="text-lg font-normal text-gray-600 dark:text-gray-400">${dateStr}</div>
            `;
        }

        // --- THEME LOGIC ---
        function toggleTheme() {
            const isDarkMode = body.classList.toggle('dark-mode');
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
            updateThemeButton(isDarkMode);
            updateWeatherDisplay(); 
        }

        function updateThemeButton(isDarkMode) {
            // Define all classes that might be applied to the button
            const allBgClasses = ['bg-gray-200', 'bg-gray-700'];
            const allHoverClasses = ['hover:bg-gray-300', 'hover:bg-gray-800'];
            const allTextClasses = ['text-gray-800', 'text-white'];
            
            // Remove all possible theme-related classes first
            themeToggleButton.classList.remove(...allBgClasses, ...allHoverClasses, ...allTextClasses);

            if (isDarkMode) {
                themeIcon.textContent = '‚òÄÔ∏è';
                themeText.textContent = 'Day Mode';
                // Apply dark mode appearance
                themeToggleButton.classList.add('bg-gray-700', 'hover:bg-gray-800', 'text-white');
            } else {
                themeIcon.textContent = 'üåô';
                themeText.textContent = 'Night Mode';
                // Apply light mode appearance
                themeToggleButton.classList.add('bg-gray-200', 'hover:bg-gray-300', 'text-gray-800');
            }
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            const isDarkMode = savedTheme === 'dark';

            if (isDarkMode) {
                body.classList.add('dark-mode');
            } else {
                body.classList.remove('dark-mode');
            }
            updateThemeButton(isDarkMode);
        }

        // --- CORE APPLICATION LOGIC (SIMPLIFIED) ---
        
        /**
         * Initializes and displays the static image on the splash screen layer.
         */
        function playIntroVideo() {
            splashImage.style.opacity = '1';
            
            // DELAY 1: Display static image for 2 seconds
            setTimeout(() => {
                onIntroVideoEnded();
            }, 2000); 
        }
        
        /**
         * Transitions from the static image to the main dashboard interface.
         */
        function onIntroVideoEnded() {
            
            // Fade out the splash image
            splashImage.style.opacity = '0'; 

            // DELAY 2: Transition time (500ms)
            setTimeout(() => {
                
                // 1. Set the dashboard's initial state
                setCarMode('DRIVE'); 
                
                // 2. Fade out the splash screen layer completely
                splashScreen.style.opacity = '0';

                // 3. Fade in the main container
                mainContainer.style.opacity = '1';
                
                // 4. Remove splash screen from the DOM after transition is complete
                setTimeout(() => {
                    splashScreen.remove();
                }, 500); 

            }, 500); 
        }

        /**
         * Sets the active car mode, updating the text color and visual display.
         */
        function setCarMode(newMode) {
            currentMode = newMode;
            modeButtons.forEach(button => {
                // Ensure inactive buttons revert to the default gray
                button.classList.remove('text-red-500');
                button.classList.add('text-gray-500'); 
            });

            const activeButton = document.getElementById(newMode);
            if (activeButton) {
                // Apply active red class
                activeButton.classList.remove('text-gray-500');
                activeButton.classList.add('text-red-500');
            }

            const sourceUrl = carVideos[newMode];
            const isVideo = sourceUrl.endsWith('.mp4');

            let tempImg = document.getElementById('temp-car-img');
            if (!tempImg) {
                tempImg = document.createElement('img');
                tempImg.id = 'temp-car-img';
                tempImg.className = 'w-full h-full object-contain transition-opacity duration-300 fade-out';
                carVideo.parentNode.appendChild(tempImg);
            }
            
            // Hide the video fallback message
            videoFallbackMessage.classList.add('hidden');
            
            if (isVideo) {
                // --- Video Mode ---
                tempImg.classList.remove('fade-in-scale');
                tempImg.classList.add('fade-out'); // Ensure image is hidden
                tempImg.style.display = 'none';
                carVideo.style.display = 'block';
                carVideo.src = sourceUrl;
                carVideo.load();
                carVideo.play().catch(error => { console.warn("Dashboard video autoplay failed", error); });
            } else {
                // --- Image Mode (PNGs) ---
                carVideo.pause(); // Pause video before hiding it
                carVideo.style.display = 'none';
                
                // 1. Hide the image immediately to reset the animation
                tempImg.classList.remove('fade-in-scale');
                tempImg.classList.add('fade-out');
                
                // 2. Set the new source and make it visible
                tempImg.src = sourceUrl;
                tempImg.style.display = 'block';
                
                // 3. Force a reflow (browser repaint) to ensure the `fade-out` state is applied
                void tempImg.offsetWidth; 
                
                // 4. Apply the fade-in class on the next tick
                setTimeout(() => {
                    tempImg.classList.remove('fade-out');
                    tempImg.classList.add('fade-in-scale');
                }, 10); // A small delay ensures the transition triggers
            }
        }

        /**
         * Initialize the state after everything is loaded.
         */
        function loadInitialState() {
            loadTheme(); 
            playIntroVideo();
            updateClock();
            updateWeatherDisplay();
            
            // Set intervals
            setInterval(updateClock, 1000);
            setInterval(cycleWeather, 60000); 
        }

        // --- Event Listeners Setup ---
        
        // Mode Controls Listener
        modeControls.addEventListener('click', (event) => {
            const modeId = event.target.id;
            if (['MANUAL', 'DRIVE', 'REVERSE', 'PARK'].includes(modeId)) {
                setCarMode(modeId);
            }
        });
        
        msgCloseButton.addEventListener('click', hideMessageBox);
        themeToggleButton.addEventListener('click', toggleTheme); 

        // FIX: Disable double-click zoom on the entire body
        document.body.addEventListener('dblclick', function(event) {
            // Prevents the default action, which is often zooming on mobile/tablet or text selection.
            event.preventDefault(); 
        });

        // Initial State Setup
        document.addEventListener('DOMContentLoaded', loadInitialState);

        /* --- Video Error Handling --- */
        carVideo.addEventListener('error', function(event) {
            console.error("Video failed to load/play:", event.target.src);
            const fileName = event.target.src.split('/').pop();
            missingVideoFilename.textContent = fileName;
            videoFallbackMessage.classList.remove('hidden');
        }, true);
    </script>
</body>
</html>
